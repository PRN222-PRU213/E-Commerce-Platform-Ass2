@page
@model E_Commerce_Platform_Ass2.Wed.Pages.ReturnRequest.DetailModel

@{
    ViewData["Title"] = "Chi tiết yêu cầu đổi trả";
    var statusClass = Model.Request!.Status switch
    {
        "Pending" => "warning",
        "Approved" => "success",
        "Rejected" => "danger",
        _ => "secondary"
    };
    var statusText = Model.Request.Status switch
    {
        "Pending" => "Đang chờ xử lý",
        "Approved" => "Đã duyệt",
        "Rejected" => "Đã từ chối",
        _ => Model.Request.Status
    };
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="mb-0">
                    <i class="fas fa-undo-alt me-2"></i>Chi tiết yêu cầu #@Model.Request.Id.ToString().Substring(0, 8).ToUpper()
                </h3>
                <a asp-page="/ReturnRequest/Index" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Quay lại
                </a>
            </div>

            <!-- Status Card -->
            <div class="card mb-4 border-@statusClass">
                <div class="card-body text-center py-4">
                    <span class="badge bg-@statusClass fs-5 px-4 py-2">@statusText</span>
                    @if (Model.Request.Status == "Approved" && Model.Request.ApprovedAmount.HasValue)
                    {
                        <p class="mt-3 mb-0 text-success fw-bold fs-4">
                            <i class="fas fa-check-circle me-2"></i>Đã hoàn @Model.Request.ApprovedAmount.Value.ToString("N0") VNĐ vào ví
                        </p>
                    }
                    @if (Model.Request.Status == "Rejected" && !string.IsNullOrEmpty(Model.Request.ShopResponse))
                    {
                        <div class="mt-3">
                            <p class="text-danger mb-1"><strong>Lý do từ chối:</strong></p>
                            <p class="mb-0">@Model.Request.ShopResponse</p>
                        </div>
                    }
                </div>
            </div>

            <!-- Request Info -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Thông tin yêu cầu</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="text-muted small">Loại yêu cầu</label>
                            <p class="mb-0 fw-bold">
                                @(Model.Request.RequestType == "Return" ? "Trả hàng + Hoàn tiền" : "Chỉ hoàn tiền")
                            </p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted small">Lý do</label>
                            <p class="mb-0 fw-bold">
                                @(Model.Request.Reason switch
                                {
                                    "Defective" => "Sản phẩm bị lỗi/hỏng",
                                    "WrongItem" => "Giao sai sản phẩm",
                                    "NotAsDescribed" => "Không đúng mô tả",
                                    "ChangeOfMind" => "Đổi ý không muốn mua nữa",
                                    _ => Model.Request.Reason
                                })
                            </p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted small">Số tiền yêu cầu</label>
                            <p class="mb-0 fw-bold text-primary">@Model.Request.RequestedAmount.ToString("N0") VNĐ</p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="text-muted small">Ngày tạo</label>
                            <p class="mb-0">@Model.Request.CreatedAt.ToString("dd/MM/yyyy HH:mm")</p>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.Request.ReasonDetail))
                        {
                            <div class="col-12 mb-3">
                                <label class="text-muted small">Chi tiết lý do</label>
                                <p class="mb-0">@Model.Request.ReasonDetail</p>
                            </div>
                        }
                    </div>

                    @if (Model.Request.EvidenceImageUrls.Any())
                    {
                        <hr>
                        <h6 class="mb-3"><i class="fas fa-images me-2"></i>Hình ảnh bằng chứng</h6>
                        <div class="row g-2">
                            @foreach (var imageUrl in Model.Request.EvidenceImageUrls)
                            {
                                <div class="col-4 col-md-3">
                                    <a href="@imageUrl" target="_blank">
                                        <img src="@imageUrl" alt="Bằng chứng" class="img-fluid rounded" 
                                             style="height: 100px; width: 100%; object-fit: cover;">
                                    </a>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>

            <!-- Order Info -->
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-shopping-bag me-2"></i>Thông tin đơn hàng</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="text-muted small">Mã đơn hàng</label>
                            <p class="mb-0 fw-bold">#@Model.Request.OrderId.ToString().Substring(0, 8).ToUpper()</p>
                        </div>
                        <div class="col-md-4">
                            <label class="text-muted small">Ngày đặt</label>
                            <p class="mb-0">@Model.Request.OrderDate.ToString("dd/MM/yyyy HH:mm")</p>
                        </div>
                        <div class="col-md-4">
                            <label class="text-muted small">Tổng giá trị</label>
                            <p class="mb-0 fw-bold text-primary">@Model.Request.OrderTotalAmount.ToString("N0") VNĐ</p>
                        </div>
                    </div>

                    <h6 class="mb-3">Sản phẩm:</h6>
                    @foreach (var item in Model.Request.OrderItems)
                    {
                        <div class="d-flex align-items-center mb-2 p-2 border rounded">
                            <img src="@(string.IsNullOrEmpty(item.ImageUrl) ? "/images/no-image.png" : item.ImageUrl)" 
                                 alt="@item.ProductName" 
                                 class="rounded me-3" 
                                 style="width: 50px; height: 50px; object-fit: cover;">
                            <div class="flex-grow-1">
                                <span class="fw-bold">@item.ProductName</span>
                                <small class="text-muted d-block">
                                    @if (!string.IsNullOrEmpty(item.Size)) { <span>Size: @item.Size</span> }
                                    @if (!string.IsNullOrEmpty(item.Color)) { <span class="ms-2">Màu: @item.Color</span> }
                                </small>
                            </div>
                            <div class="text-end">
                                <span>@item.Price.ToString("N0") VNĐ x @item.Quantity</span>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
